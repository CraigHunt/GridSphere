<!--
Build include file for the GridSphere Portal source code, see build.xml

 - $Id$

-->

<project name="GridSphere Jar">

    <!-- Compiles the sourcecode and makes jar's. Include file to build.xm -->

    <!-- =================================================================== -->
    <!-- Compiles core framework                                             -->
    <!-- =================================================================== -->
    <target name="compile" depends="setenv" description="Compile core framework">
        <echo>Compiling core framework</echo>
        <javac srcdir="src"
            destdir="${build.classes}"
            classpathref="classpath"
            debug="${debug}"
            optimize="${optimize}"
            deprecation="${deprecation}"/>
    </target>

    <!-- =================================================================== -->
    <!-- Compiles JUnit tests                                                -->
    <!-- =================================================================== -->
    <target name="compile-tests" depends="compile" description="Compiles all JUnit tests">
        <echo>Compiling JUnit Tests</echo>
        <javac srcdir="tests"
            destdir="${build.classes}"
            classpathref="classpath"
            debug="${debug}"
            optimize="${optimize}"
            deprecation="${deprecation}">
        </javac>
    </target>

    <!-- =================================================================== -->
    <!-- Internal target to create the GridSphere JAR library archive        -->
    <!-- =================================================================== -->
    <target name="gridsphere-jar" depends="compile" description="Makes gridsphere JAR">

        <ant target="make-gridsphere-jar"/>
    </target>

    <!-- =================================================================== -->
    <!-- Internal target to create the GridSphere JAR library archive        -->
    <!-- =================================================================== -->
    <target name="gridsphere-test-jar" depends="compile-tests" description="Makes gridsphere test JAR">

        <echo message="Configuring Test Database"/>

        <jar jarfile="${build.lib}/gridsphere-test.jar" basedir="${build.classes}">
            <include name="**/*Test.class"/>
        </jar>

        <ant target="make-gridsphere-jar"/>

    </target>

    <target name="make-gridsphere-jar" depends="compile">

        <mkdir dir="${build.classes}/gridsphere"/>

        <jar jarfile="${build.lib}/gridsphere.jar" basedir="${build.classes}" defaultexcludes="yes">

            <include name="org/**"/>
            <!-- <include name="gridsphere/log4j.properties"/>  -->
            <!-- don't include portlet API -->
            <exclude name="org/gridlab/gridsphere/portlet/**"/>
            <!-- don't include gs servlet -->
            <exclude name="org/gridlab/gridsphere/servlets/**"/>
            <exclude name="org/gridlab/gridsphere/event/**"/>
            <!-- don't include portlet widgets tag library -->
            <exclude name="org/gridlab/gridsphere/provider/**"/>
            <!-- don't include GridSphere portlets  -->
            <exclude name="org/gridlab/gridsphere/portlets/**"/>

        </jar>
    </target>

    <!-- =================================================================== -->
    <!-- Creates a Portlet API JAR library archive                           -->
    <!-- =================================================================== -->
    <target name="portlet-jar" depends="compile" description="Create lib/portlet.jar">
        <jar jarfile="${build.lib}/portlet-api.jar" basedir="${build.classes}">
            <include name="org/gridlab/gridsphere/portlet/**"/>
            <exclude name="**/jsrimpl/**"/>
            <include name="org/gridlab/gridsphere/event/**"/>
            <exclude name="**/*Test.class"/>
            <!--  <include name="gridsphere/log4j.properties"/>  -->
        </jar>
    </target>

    <!-- =================================================================== -->
    <!-- Creates a JSR Portlet API JAR library archive configured            -->
    <!-- =================================================================== -->
    <target name="portlet-api-jar" depends="compile" description="Creates JSR portlet API JAR">
        <echo>Creating JSR portlet API JAR</echo>
        <jar jarfile="${build.lib}/portlet-jsr-api.jar" basedir="${build.classes}">
            <include name="javax/**"/>
            <include name="**/portlet/jsrimpl/**"/>
        </jar>
    </target>

    <!-- =================================================================== -->
    <!-- Creates the GridSphere UI tags JAR                                  -->
    <!-- =================================================================== -->
    <target name="gridsphere-ui-tags-jar" depends="compile" description="Create lib/gridsphere-ui-tags.jar">
        <jar jarfile="${build.lib}/gridsphere-ui-tags.jar" basedir="${build.classes}">
            <include name="gridsphere/log4j.properties"/>
            <include name="org/gridlab/gridsphere/provider/portlet/**"/>
            <include name="org/gridlab/gridsphere/provider/portletui/tags/**"/>
            <metainf dir="${gswebapp.dir}/WEB-INF/tlds"/>
        </jar>
    </target>

    <!-- =================================================================== -->
    <!-- Creates the GridSphere test JAR                                     -->
    <!-- =================================================================== -->
    <target name="gridsphere-provider-jar" depends="compile" description="Create lib/gridsphere-provider.jar">
        <copy todir="${build.classes}/gridsphere/resources">
            <fileset dir="config/resources"/>
        </copy>
        <jar jarfile="${build.lib}/gridsphere-provider.jar" basedir="${build.classes}">
            <include name="org/gridlab/gridsphere/provider/event/**"/>
            <include name="org/gridlab/gridsphere/provider/portletui/beans/**"/>
            <include name="org/gridlab/gridsphere/provider/portletui/model/**"/>
            <include name="gridsphere/**"/>
        </jar>
    </target>

    <!-- =================================================================== -->
    <!-- Creates the GridSphere portlets JAR                                 -->
    <!-- =================================================================== -->
    <target name="coreportlets-jar" depends="compile" description="Create lib/coreportlets.jar">
        <jar jarfile="${build.lib}/coreportlets.jar" basedir="${build.classes}">
            <include name="org/gridlab/gridsphere/portlets/**"/>
            <include name="org/gridlab/gridsphere/servlets/**"/>
        </jar>
    </target>

    <!-- =================================================================== -->
    <!-- Creates all JAR's                                                   -->
    <!-- =================================================================== -->
    <target name="jar" depends="gridsphere-ui-tags-jar, gridsphere-provider-jar, portlet-api-jar, portlet-jar, coreportlets-jar" description="Creates all jars"/>

    <!--

        not working yet!!

        <target name="jspc" depends="jar">
            <mkdir dir="${gridsphere.build}/jsp/classes"/>
            <mkdir dir="${gridsphere.build}/jsp/source"/>
            <jspc destdir="${gridsphere.build}/jsp/source"
                verbose="9"
                srcdir="webapps/gridsphere/jsp"
                classpathref="classpath">
                <include name="**/*.jsp"/>
                <webapp basedir="build/webapps/gridsphere"/>
            </jspc>
            <depend
                srcdir="${gridsphere.build}/jsp/source"
                destdir="${gridsphere.build}/jsp/classes"
                cache="${gridsphere.build}/jsp/dependencies"
                classpath="lib/gridsphere-ui-tags.jar"/>
            <javac
                srcdir="${gridsphere.build}/jsp/source"
                destdir="${gridsphere.build}/jsp/classes"
                classpath="${build.lib}/gridsphere-ui-tags.jar"
                classpathhref="classpath"
                debug="on"/>


        </target>

        -->
</project>
